{% extends "base.html" %}

{% block title %}{{ t('system.title') }} - {{ t('app.name') }}{% endblock %}

{% block content %}
<h1 class="page-title">{{ t('system.title') }}</h1>

<form method="post">
    <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
    
    <div class="section">
        <h3>{{ t('system.basic') }}</h3>
        <div class="form-row">
            <div class="form-group">
                <label>{{ t('system.hostname') }}</label>
                <input type="text" name="hostname" value="{{ config.system.hostname | default('watchdog') }}">
            </div>
            
            <div class="form-group">
                <label>{{ t('system.web_port') }}</label>
                <input type="number" name="web_port" value="{{ config.system.web_port | default(80) }}" min="80" max="65535">
            </div>
            
            <div class="form-group">
                <label>{{ t('system.check_interval') }} (s)</label>
                <input type="number" name="check_interval" value="{{ config.check_interval | default(10) }}" min="5" max="300">
            </div>
            
            <div class="form-group">
                <label>{{ t('system.debug_mode') }}</label>
                <select name="debug">
                    <option value="false" {% if not config.system.debug %}selected{% endif %}>{{ t('common.no') }}</option>
                    <option value="true" {% if config.system.debug %}selected{% endif %}>{{ t('common.yes') }}</option>
                </select>
            </div>
        </div>
        
        <div class="form-group">
            <label>{{ t('system.ntp_servers') }}</label>
            <input type="text" name="ntp_servers" value="{{ config.system.ntp_servers | default([]) | join(' ') }}">
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label>{{ 'ƒåasov√© p√°smo' if language == 'cs' else 'Timezone' }}</label>
                <select name="timezone">
                    {% for tz in timezones %}
                    <option value="{{ tz }}" {% if config.system.timezone == tz %}selected{% endif %}>{{ tz }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label>{{ 'V√Ωchoz√≠ jazyk' if language == 'cs' else 'Default Language' }}</label>
                <select name="default_language">
                    {% for code, lang_info in languages.items() %}
                    <option value="{{ code }}" {% if config.system.default_language == code %}selected{% endif %}>
                        {{ lang_info.flag }} {{ lang_info.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </div>
    
    <div class="section">
        <h3>{{ t('system.features') }}</h3>
        <div class="form-row">
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="ping_stats" value="true" 
                           {% if config.features.ping_stats | default(true) %}checked{% endif %}>
                    {{ 'Statistiky' if language == 'cs' else 'Statistics' }}
                </label>
                <div class="help">{{ 'Sbƒõr statistik a zobrazen√≠ graf≈Ø na dashboardu' if language == 'cs' else 'Collect statistics and show charts on dashboard' }}</div>
            </div>
            
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="live_status" value="true" 
                           {% if config.features.live_status | default(true) %}checked{% endif %}>
                    {{ t('system.live_status') }}
                </label>
                <div class="help">{{ 'Automatick√© obnovov√°n√≠ statusu na dashboardu' if language == 'cs' else 'Auto-refresh dashboard status' }}</div>
            </div>
        </div>
    </div>
    
    <div class="section">
        <h3>{{ t('system.ssl') }}</h3>
        <div class="form-row">
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="ssl_enabled" value="true" 
                           {% if config.system.ssl_enabled %}checked{% endif %}>
                    {{ t('system.ssl_enabled') }}
                </label>
                <div class="help">{{ 'Vy≈æaduje certifik√°t v /opt/watchdog/ssl/' if language == 'cs' else 'Requires certificate in /opt/watchdog/ssl/' }}</div>
            </div>
            
            <div class="form-group">
                <label>{{ t('system.ssl_port') }}</label>
                <input type="number" name="ssl_port" value="{{ config.system.ssl_port | default(443) }}" min="443" max="65535">
            </div>
        </div>
    </div>
    
    <div class="section">
        <h3>{{ t('system.logging') }}</h3>
        <div class="form-row">
            <div class="form-group">
                <label>{{ 'Max. velikost logu' if language == 'cs' else 'Max log size' }} (KB)</label>
                <input type="number" name="log_max_kb" value="{{ config.log_max_kb | default(512) }}" min="100" max="10240">
                <div class="help">{{ 'Po p≈ôekroƒçen√≠ se log rotuje' if language == 'cs' else 'Log rotates when exceeded' }}</div>
            </div>
            
            <div class="form-group">
                <label>{{ '≈ò√°dk≈Ø na str√°nce' if language == 'cs' else 'Lines per page' }}</label>
                <input type="number" name="log_view_lines" value="{{ config.log_view_lines | default(50) }}" min="10" max="200">
            </div>
            
            <div class="form-group">
                <label>{{ 'Audit - uchovat dn≈Ø' if language == 'cs' else 'Audit - keep days' }}</label>
                <input type="number" name="audit_retention_days" value="{{ config.audit_retention_days | default(90) }}" min="7" max="365">
                <div class="help">{{ 'Star≈°√≠ z√°znamy se automaticky ma≈æou' if language == 'cs' else 'Older records are auto-deleted' }}</div>
            </div>
            
            <div class="form-group">
                <label>{{ 'Statistiky - uchovat dn≈Ø' if language == 'cs' else 'Stats - keep days' }}</label>
                <input type="number" name="stats_retention_days" value="{{ config.stats_retention_days | default(30) }}" min="1" max="365">
                <div class="help">{{ 'Star≈°√≠ statistiky se automaticky ma≈æou' if language == 'cs' else 'Older stats are auto-deleted' }}</div>
            </div>
        </div>
    </div>
    
    <div class="section">
        <h3>{{ '√ödr≈æba dat' if language == 'cs' else 'Data Maintenance' }}</h3>
        <p style="color: var(--text-secondary); margin-bottom: 15px;">
            {{ 'Ruƒçn√≠ spr√°va z√°loh a dat.' if language == 'cs' else 'Manual backup and data management.' }}
        </p>
        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
            <form method="post" action="/system/backup-config" style="display: inline;">
                <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="btn btn-primary">
                    üíæ {{ 'Z√°lohovat config' if language == 'cs' else 'Backup Config' }}
                </button>
            </form>
            
            <button type="button" class="btn btn-secondary" onclick="document.getElementById('restore-modal').style.display='flex'">
                üìÇ {{ 'Obnovit ze z√°lohy' if language == 'cs' else 'Restore Backup' }}
            </button>
            
            <form method="post" action="/system/clear-stats" style="display: inline;">
                <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="btn btn-secondary" onclick="return confirm('{{ 'Smazat v≈°echny statistiky?' if language == 'cs' else 'Delete all statistics?' }}')">
                    üìä {{ 'Smazat statistiky' if language == 'cs' else 'Clear Statistics' }}
                </button>
            </form>
            
            <form method="post" action="/system/clear-old-logs" style="display: inline;">
                <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="btn btn-secondary" onclick="return confirm('{{ 'Smazat rotovan√© logy?' if language == 'cs' else 'Delete rotated logs?' }}')">
                    üìÑ {{ 'Smazat rotovan√© logy' if language == 'cs' else 'Clear Rotated Logs' }}
                </button>
            </form>
        </div>
    </div>

<!-- Restore Modal -->
<div id="restore-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center;">
    <div style="background: var(--card-bg); padding: 30px; border-radius: 10px; max-width: 500px; width: 90%;">
        <h3 style="margin-top: 0;">üìÇ {{ 'Obnovit konfiguraci' if language == 'cs' else 'Restore Configuration' }}</h3>
        <form method="post" action="/system/restore-config">
            <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
            
            <div class="form-group">
                <label>{{ 'Vyberte z√°lohu' if language == 'cs' else 'Select backup' }}:</label>
                <select name="backup_file" style="width: 100%; padding: 10px; margin-top: 5px;">
                    {% for backup in backups %}
                    <option value="{{ backup.file }}">{{ backup.date }} ({{ backup.size }})</option>
                    {% else %}
                    <option value="">{{ '≈Ω√°dn√© z√°lohy' if language == 'cs' else 'No backups' }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <p style="color: var(--warning-color); font-size: 0.9em; margin: 15px 0;">
                ‚ö†Ô∏è {{ 'Souƒçasn√° konfigurace bude p≈ôeps√°na!' if language == 'cs' else 'Current config will be overwritten!' }}
            </p>
            
            <div style="display: flex; gap: 10px;">
                <button type="submit" class="btn btn-primary" {% if not backups %}disabled{% endif %}>
                    {{ 'Obnovit' if language == 'cs' else 'Restore' }}
                </button>
                <button type="button" class="btn btn-secondary" onclick="document.getElementById('restore-modal').style.display='none'">
                    {{ 'Zru≈°it' if language == 'cs' else 'Cancel' }}
                </button>
            </div>
        </form>
    </div>
</div>
    
    <button type="submit" class="btn btn-primary">{{ t('common.save') }}</button>
</form>

<div class="section" style="margin-top: 30px;">
    <h3>{{ 'Aktualizace' if language == 'cs' else 'Updates' }}</h3>
    
    {% if git_installed %}
    <p style="color: var(--success-color); margin-bottom: 15px;">
        ‚úÖ {{ 'Git instalace - aktualizace p≈ôes web UI nebo p≈ô√≠kaz' if language == 'cs' else 'Git install - update via web UI or command' }}
    </p>
    <div style="background: var(--bg-secondary); padding: 15px; border-radius: 5px; margin-bottom: 15px;">
        <code>cd /opt/watchdog && sudo git pull && sudo bash install.sh</code>
    </div>
    <a href="/updates" class="btn btn-secondary">‚¨áÔ∏è {{ 'Zkontrolovat aktualizace' if language == 'cs' else 'Check for Updates' }}</a>
    {% else %}
    <p style="color: var(--warning-color); margin-bottom: 15px;">
        ‚ö†Ô∏è {{ 'Ruƒçn√≠ instalace - aktualizace pomoc√≠ skriptu' if language == 'cs' else 'Manual install - update via script' }}
    </p>
    <div style="background: var(--bg-secondary); padding: 15px; border-radius: 5px; margin-bottom: 15px;">
        <p style="margin-bottom: 10px;">{{ 'Pro aktualizaci spus≈•te:' if language == 'cs' else 'To update, run:' }}</p>
        <code>sudo bash /opt/watchdog/update.sh</code>
    </div>
    <p style="color: var(--text-secondary); font-size: 0.9em;">
        {{ 'Skript automaticky st√°hne nejnovƒõj≈°√≠ verzi z GitHubu a aktualizuje v≈°echny soubory.' if language == 'cs' else 'The script will automatically download the latest version from GitHub and update all files.' }}
    </p>
    {% endif %}
</div>

<div class="section" style="margin-top: 30px;">
    <h3>{{ t('system.export_import') }}</h3>
    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
        <a href="/export" class="btn btn-secondary">üì• {{ t('system.export') }}</a>
        
        <form method="post" action="/import" enctype="multipart/form-data" style="display: flex; gap: 10px;">
            <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
            <input type="file" name="config_file" accept=".json" required style="padding: 5px;">
            <button type="submit" class="btn btn-secondary">üì§ {{ t('system.import') }}</button>
        </form>
    </div>
</div>
{% endblock %}
